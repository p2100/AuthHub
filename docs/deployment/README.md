# AuthHub éƒ¨ç½²æ–‡æ¡£

æœ¬ç›®å½•åŒ…å« AuthHub çš„å„ç§éƒ¨ç½²æ–¹å¼æ–‡æ¡£ã€‚

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

### å¿«é€Ÿå¼€å§‹

- **[å¿«é€Ÿéƒ¨ç½²æŒ‡å—](./QUICKSTART.md)** â­ï¸ æ¨è
  - 5 åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²
  - ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“
  - ä¸€é”®éƒ¨ç½²è„šæœ¬

### è¯¦ç»†æŒ‡å—

- **[è‡ªå»ºæœåŠ¡å™¨å®Œæ•´éƒ¨ç½²æŒ‡å—](./self-hosted-deployment.md)**
  - Docker éƒ¨ç½²æ–¹å¼
  - æºç éƒ¨ç½²æ–¹å¼
  - å¤–éƒ¨æ•°æ®åº“é…ç½®
  - Nginx åå‘ä»£ç†é…ç½®
  - ç›‘æ§å’Œç»´æŠ¤
  - æ€§èƒ½ä¼˜åŒ–å»ºè®®

- **[SSL è¯ä¹¦é…ç½®æŒ‡å—](./ssl-certificate-guide.md)** â­ï¸ æ¨è
  - Cloudflare å…è´¹ SSLï¼ˆæœ€ç®€å•ï¼‰
  - Cloudflare Origin CA è¯ä¹¦
  - Let's Encrypt è‡ªåŠ¨ç»­æœŸ
  - è‡ªç­¾åè¯ä¹¦ï¼ˆæµ‹è¯•ç”¨ï¼‰

- **[Cloudflare + Nginx æ•…éšœæ’æŸ¥](./cloudflare-nginx-troubleshooting.md)** ğŸ”§
  - é‡å®šå‘å¾ªç¯é—®é¢˜è§£å†³
  - upstream é”™è¯¯ä¿®å¤
  - å®Œæ•´é…ç½®æ¨¡æ¿
  - è¯Šæ–­å‘½ä»¤å¤§å…¨

- **[Cloud Run éƒ¨ç½²æŒ‡å—](../deployment-cloudrun.md)**
  - Google Cloud Run éƒ¨ç½²
  - äº‘æ•°æ®åº“é…ç½®
  - è‡ªåŠ¨æ‰©ç¼©å®¹

### å…¶ä»–æ–‡æ¡£

- **[æ•°æ®åº“è¿æ¥é€‰é¡¹](../cloudrun-db-connection-options.md)**
  - Cloud SQL è¿æ¥æ–¹å¼
  - Unix Socket vs TCP
  - è¿æ¥æ± é…ç½®

## ğŸ¯ é€‰æ‹©éƒ¨ç½²æ–¹å¼

```mermaid
%%{init: {'theme':'dark'}}%%
graph TD
    Start[å¼€å§‹éƒ¨ç½²] --> Q1{æœ‰äº‘æœåŠ¡å™¨?}
    
    Q1 -->|æ˜¯| Q2{å·²æœ‰æ•°æ®åº“?}
    Q1 -->|å¦| Cloud[Cloud Run éƒ¨ç½²<br/>æ‰˜ç®¡æœåŠ¡]
    
    Q2 -->|æ˜¯| External[Docker éƒ¨ç½²<br/>å¤–éƒ¨æ•°æ®åº“]
    Q2 -->|å¦| Q3{éœ€è¦æ•°æ®æŒä¹…åŒ–?}
    
    Q3 -->|æ˜¯| Setup[å…ˆå®‰è£…æ•°æ®åº“]
    Q3 -->|å¦| Dev[å¼€å‘ç¯å¢ƒ<br/>docker-compose]
    
    Setup --> External
    
    External --> Doc1[ğŸ“– QUICKSTART.md]
    Cloud --> Doc2[ğŸ“– deployment-cloudrun.md]
    Dev --> Doc3[ğŸ“– README.md]
    
    style External fill:#4A90E2,stroke:#2E5C8A,color:#fff
    style Cloud fill:#34A853,stroke:#1F6E34,color:#fff
    style Dev fill:#FBBC04,stroke:#B87E00,color:#fff
    style Doc1 fill:#EA4335,stroke:#A52E24,color:#fff
    style Doc2 fill:#EA4335,stroke:#A52E24,color:#fff
    style Doc3 fill:#EA4335,stroke:#A52E24,color:#fff
```

### éƒ¨ç½²æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ–‡æ¡£ |
|------|---------|------|------|------|
| **Docker + å¤–éƒ¨æ•°æ®åº“** | ç”Ÿäº§ç¯å¢ƒ | âœ… çµæ´»å¯æ§<br>âœ… æˆæœ¬å¯æ§<br>âœ… æ•°æ®å®‰å…¨ | âŒ éœ€è¦è¿ç»´<br>âŒ éœ€è¦æœåŠ¡å™¨ | [QUICKSTART.md](./QUICKSTART.md) |
| **Cloud Run** | å¿«é€Ÿä¸Šçº¿ | âœ… è‡ªåŠ¨æ‰©å®¹<br>âœ… æ— éœ€è¿ç»´<br>âœ… æŒ‰é‡ä»˜è´¹ | âŒ ä¾èµ–äº‘æœåŠ¡<br>âŒ å†·å¯åŠ¨å»¶è¿Ÿ | [deployment-cloudrun.md](../deployment-cloudrun.md) |
| **æºç éƒ¨ç½²** | å®šåˆ¶éœ€æ±‚ | âœ… å®Œå…¨æ§åˆ¶<br>âœ… ä¾¿äºè°ƒè¯• | âŒ é…ç½®å¤æ‚<br>âŒ ç»´æŠ¤æˆæœ¬é«˜ | [self-hosted-deployment.md](./self-hosted-deployment.md) |
| **Docker Compose** | å¼€å‘æµ‹è¯• | âœ… ä¸€é”®å¯åŠ¨<br>âœ… ç¯å¢ƒéš”ç¦» | âŒ ä¸é€‚åˆç”Ÿäº§<br>âŒ æ€§èƒ½æœ‰é™ | [README.md](../../README.md) |

## ğŸš€ æ¨èéƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ¬¡éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/AuthHub.git
cd AuthHub

# 2. è¿è¡Œå¿«é€Ÿéƒ¨ç½²è„šæœ¬
./scripts/setup-production.sh

# 3. æŒ‰ç…§æç¤ºå®Œæˆé…ç½®
# - é…ç½®æ•°æ®åº“è¿æ¥
# - é…ç½®é£ä¹¦åº”ç”¨
# - é…ç½®åŸŸåå’Œ CORS

# 4. éªŒè¯éƒ¨ç½²
curl http://localhost:8080/health

# 5. é…ç½® Nginx åå‘ä»£ç†
# å‚è€ƒ: docs/deployment/self-hosted-deployment.md#é…ç½®åå‘ä»£ç†

# 6. é…ç½®é£ä¹¦å›è°ƒåœ°å€
# https://your-domain.com/api/auth/feishu/callback
```

### å¼€å‘ç¯å¢ƒ

```bash
# åç«¯å¼€å‘
cd backend
cp .env.example .env
uv sync
python scripts/generate_keys.py
uv run alembic upgrade head
uvicorn app.main:app --reload

# å‰ç«¯å¼€å‘
cd frontend
pnpm install
pnpm dev
```

## ğŸ”§ é…ç½®è¦æ±‚

### æœ€å°é…ç½®ï¼ˆå¼€å‘ï¼‰

- CPU: 2 æ ¸
- å†…å­˜: 2GB
- ç¡¬ç›˜: 10GB
- æ•°æ®åº“: PostgreSQL 15+
- ç¼“å­˜: Redis 7+

### æ¨èé…ç½®ï¼ˆç”Ÿäº§ï¼‰

- CPU: 4 æ ¸
- å†…å­˜: 8GB
- ç¡¬ç›˜: 50GB
- æ•°æ®åº“: PostgreSQL 15+ (ç‹¬ç«‹æœåŠ¡å™¨)
- ç¼“å­˜: Redis 7+ (ç‹¬ç«‹æœåŠ¡å™¨)
- è´Ÿè½½å‡è¡¡: Nginx
- SSL: Let's Encrypt

### å¤§è§„æ¨¡éƒ¨ç½²

- CPU: 8+ æ ¸
- å†…å­˜: 16GB+
- ç¡¬ç›˜: 100GB+ SSD
- æ•°æ®åº“: PostgreSQL é›†ç¾¤
- ç¼“å­˜: Redis å“¨å…µ/é›†ç¾¤
- è´Ÿè½½å‡è¡¡: Nginx + å¤šå®ä¾‹
- CDN: Cloudflare/é˜¿é‡Œäº‘
- ç›‘æ§: Prometheus + Grafana

## ğŸ“Š éƒ¨ç½²æ¶æ„

### å°å‹éƒ¨ç½²ï¼ˆå•æœºï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å•å°æœåŠ¡å™¨                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Docker: AuthHub             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PostgreSQL                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Redis                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Nginx                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸­å‹éƒ¨ç½²ï¼ˆåˆ†ç¦»æ•°æ®åº“ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨æœåŠ¡å™¨       â”‚â”€â”€â”€â”€â†’â”‚ æ•°æ®åº“æœåŠ¡å™¨  â”‚
â”‚  - Docker         â”‚     â”‚ - PostgreSQL â”‚
â”‚  - AuthHub        â”‚     â”‚ - Redis      â”‚
â”‚  - Nginx          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤§å‹éƒ¨ç½²ï¼ˆé›†ç¾¤ï¼‰

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  è´Ÿè½½å‡è¡¡(Nginx)  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ AuthHub  â”‚    â”‚ AuthHub  â”‚   â”‚ AuthHub  â”‚
    â”‚ å®ä¾‹ 1    â”‚    â”‚ å®ä¾‹ 2    â”‚   â”‚ å®ä¾‹ 3    â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                               â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ PostgreSQL    â”‚          â”‚    Redis     â”‚
    â”‚ ä¸»ä»å¤åˆ¶       â”‚          â”‚    é›†ç¾¤      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” å®‰å…¨æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®ä¿ï¼š

- [ ] æ•°æ®åº“ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘ 16 ä½ï¼‰
- [ ] Redis é…ç½®å¯†ç è®¤è¯
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å¯ç”¨ HTTPSï¼ˆSSL è¯ä¹¦ï¼‰
- [ ] é™åˆ¶æ•°æ®åº“ä»…å†…ç½‘è®¿é—®
- [ ] å®šæœŸå¤‡ä»½æ•°æ®åº“å’Œå¯†é’¥
- [ ] é…ç½®æ—¥å¿—è½®è½¬
- [ ] è®¾ç½®ç›‘æ§å‘Šè­¦
- [ ] æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸
- [ ] ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

## ğŸ“¦ å¤‡ä»½ç­–ç•¥

### å¿…é¡»å¤‡ä»½

1. **RSA å¯†é’¥** (`keys/` ç›®å½•) - æœ€é‡è¦ï¼
2. **PostgreSQL æ•°æ®åº“**
3. **Redis æŒä¹…åŒ–æ–‡ä»¶**
4. **ç¯å¢ƒé…ç½®** (`.env` æ–‡ä»¶)

### å¤‡ä»½è„šæœ¬

```bash
#!/bin/bash
BACKUP_DIR="/backup/authhub"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
pg_dump -U authhub -h localhost authhub | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# å¤‡ä»½ Redis
redis-cli -a password save
cp /var/lib/redis/dump.rdb $BACKUP_DIR/redis_$DATE.rdb

# å¤‡ä»½å¯†é’¥
tar -czf $BACKUP_DIR/keys_$DATE.tar.gz keys/

# åˆ é™¤ 7 å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -type f -mtime +7 -delete
```

## ğŸ†˜ æ•…éšœå¤„ç†

### å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ | æ–‡æ¡£ |
|------|---------|---------|------|
| æ•°æ®åº“è¿æ¥å¤±è´¥ | è¿æ¥å­—ç¬¦ä¸²é”™è¯¯ | æ£€æŸ¥ DATABASE_URL | [æ•…éšœæ’æŸ¥](#) |
| Redis è¿æ¥å¤±è´¥ | å¯†ç é”™è¯¯ | æ£€æŸ¥ REDIS_URL | [æ•…éšœæ’æŸ¥](#) |
| é£ä¹¦å›è°ƒ 404 | å›è°ƒåœ°å€é…ç½®é”™è¯¯ | æ£€æŸ¥é£ä¹¦åå°é…ç½® | [SSO é›†æˆ](../sso-integration-guide.md) |
| CORS é”™è¯¯ | è·¨åŸŸé…ç½®ä¸æ­£ç¡® | æ›´æ–° CORS_ORIGINS | [é…ç½®è¯´æ˜](#) |
| Token å¤±æ•ˆ | å¯†é’¥æ–‡ä»¶ä¸¢å¤± | æ¢å¤å¯†é’¥å¤‡ä»½ | [å®‰å…¨å»ºè®®](#) |

### ç´§æ€¥æ¢å¤

```bash
# 1. åœæ­¢æœåŠ¡
docker-compose -f docker-compose-production.yml down

# 2. æ¢å¤æ•°æ®åº“
psql -U authhub -h localhost authhub < backup.sql

# 3. æ¢å¤å¯†é’¥
tar -xzf keys-backup.tar.gz

# 4. é‡å¯æœåŠ¡
docker-compose -f docker-compose-production.yml up -d
```

## ğŸ“ è·å–æ”¯æŒ

- ğŸ“– æŸ¥çœ‹æ–‡æ¡£: [docs/](../)
- ğŸ› æäº¤ Issue: [GitHub Issues](https://github.com/your-org/AuthHub/issues)
- ğŸ’¬ ç¤¾åŒºè®¨è®º: [Discussions](https://github.com/your-org/AuthHub/discussions)
- ğŸ“§ é‚®ä»¶æ”¯æŒ: support@your-company.com

---

ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€

